name: Sync to Repo scv_router_server

on:
  push:
    branches: [ "main" ] # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰ (masterë¼ë©´ masterë¡œ ìˆ˜ì •)

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. í˜„ì¬ C ë ˆí¬ì˜ ì½”ë“œë¥¼ ë‚´ë ¤ë°›ìŒ
      - name: Checkout Source Repo (C)
        uses: actions/checkout@v4

      # 2. íƒ€ê²Ÿ B ë ˆí¬ë¥¼ 'destination' í´ë”ì— ë‚´ë ¤ë°›ìŒ
      - name: Checkout Destination Repo (B)
        uses: actions/checkout@v4
        with:
          repository: scv-c/scvc_router_server # ğŸ‘ˆ [ìˆ˜ì •í•„ìš”] B ë ˆí¬ ì£¼ì†Œ (ì˜ˆ: gildong/project-b)
          token: ${{ secrets.DESTINATION_TOKEN }} # ì•„ê¹Œ ë“±ë¡í•œ í† í° ì‚¬ìš©
          path: destination

      # 3. íŒŒì¼ ë³µì‚¬ (rsync ì‚¬ìš©)
      # .git í´ë”ì™€ github ì›Œí¬í”Œë¡œìš° íŒŒì¼ì€ ì œì™¸í•˜ê³  ë³µì‚¬í•©ë‹ˆë‹¤.
      - name: Copy files from C to B
        run: |
          rsync -av --delete --exclude='.git' --exclude='.github' --exclude='destination' ./ destination/

      # 4. B ë ˆí¬ì— ì»¤ë°‹í•˜ê³  í‘¸ì‹œ
      - name: Push to Destination Repo (B)
        run: |
          cd destination
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸
          if [ -n "$(git status --porcelain)" ]; then
            git add .
            git commit -m "Sync from Repo C: ${{ github.event.head_commit.message }}"
            git push origin main # B ë ˆí¬ì˜ ë¸Œëœì¹˜ëª… (main ë˜ëŠ” master)
            echo "âœ… ë°°í¬ ì™„ë£Œ!"
          else
            echo "ë³€ë™ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          fi